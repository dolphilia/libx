# libx 開発原則（決定版・改訂案）

本ドキュメントは、libx の開発・運用における意思決定基準を明文化し、誰が関わっても同じ品質と体験を実現するための共通言語を提供します。特に「IT の専門家ではない執筆者・翻訳者でも快適に運用できること」を最重要要件とします。

## 目的と適用範囲

- Astro ベースのモノレポで複数のドキュメントサイトを一元管理し、共通 UI / テーマ / i18n / バージョニングを共有する。
- 翻訳を含むドキュメント制作の学習コストを下げ、読みやすさと保守性の両立を図る。
- 本原則はリポジトリ全体（`apps/`, `packages/`, `scripts/`）に適用する。

## 想定読者と体験目標（Author Experience）

- 非エンジニアの執筆者・翻訳者が、CLI の専門知識がなくても日常作業を完遂できる。
- 直感的な「ファイルベース管理」で、階層と命名だけで大半の操作が成立する。
- 必須設定は最小限。詳細は「オプション」として段階的に開ける（progressive disclosure）。
- 標準は MDX を第一に。必要に応じて知見のある人が Astro コンポーネントで拡張できる。
- 著作権表示・バージョン差分・サイドバー生成など、面倒・難解な作業は半自動化で支援する。

## 意思決定ルール（優先順位）

1. 安全性 ≥ 直感性：衝突する場合は安全性を優先。衝突しない限りは直感性を常に優先。
2. 作者体験 ≥ 実装者都合：作者の操作は最短・最少・明快にする。
3. 一元化 ≥ 個別最適：モノレポの共有資産で再利用・保守容易性を高める。ただし管理性やシンプルさを損なわない範囲に限る。
4. 可読性・アクセシビリティ ≥ 装飾：読みやすさ・分かりやすさ・アクセシビリティを常に守る。
5. 自動化 ≥ 手作業：人手のばらつきを減らし、再現性と安全性を高める。

## アーキテクチャ原則（モノレポ）

- `pnpm` ワークスペースを前提とし、共有パッケージ（例：`@docs/ui`, `@docs/theme`, `@docs/i18n`, `@docs/versioning`）でデザイン・国際化・版管理の共通基盤を提供する。
- 一元管理の対象：デザイントークン、タイポグラフィ、共通レイアウト、ナビゲーション生成、著作権表記ロジック、国際化ユーティリティ。
- レイアウトに関わるCSSは `packages/theme` 配下（例：`@docs/theme/css/starlight-overrides.css`）に集約し、アプリ側のレイアウトコンポーネントではインラインスタイルを持たない。
- 各アプリ固有の要件は拡張ポイントで吸収し、無秩序な分岐や複製を避ける。プロジェクト側の独自化は最小・明示・可逆を原則とする。

## コンテンツ管理原則（ファイルベース）

- ディレクトリ構造で「バージョン」「言語」「カテゴリ」を表現し、`NN-` 連番で順序を決定する。
- 必須 Frontmatter は最小限にし、足りない情報は既定値（`project.config.json` など）で補う。
- サイドバーやルーティングは自動生成を基本とし、手作業変更時はスクリプトで整合性を検証する。
- バージョン追加・言語追加・ドキュメント作成は `scripts/` のユーティリティを用い、設定の同期を自動化する。

## 著作権・ライセンスと表記の半自動化

- 翻訳元のライセンス確認を徹底し、再配布可能な素材のみ取り込む（詳細は `docs/LICENSE_GUIDELINES.md`）。
- 帰属表示とライセンス URL は設定から自動注入し、手作業の抜け漏れを防ぐ。
- バージョン差や翻訳ステータスの表示は可能な限り自動化し、執筆者の認知負荷を下げる。

## 執筆体験（MDX ファースト / Astro で拡張）

- MDX を標準とし、注記や警告、表、コードブロックなどは簡潔なシンタックスで記述できる。
- よくある表現（アドモニション、インクルード、タブ UI 等）は「ショートコード」や共通コンポーネントで提供する。
- 高度なニーズは Astro コンポーネントで拡張可能にしつつ、MDX だけで完結できる経路を常に用意する。

## 自動化・検証・安全装置

- 生成・同期系スクリプトは `--dry-run` とバリデーションを備え、実行前に差分と副作用を明示する。
- 変更時は最低限 `pnpm build`（必要に応じて `pnpm build:sidebar`）で構造破壊がないか検証する。
- 共有パッケージ変更は複数アプリで確認し、想定外の副作用を検知する。
- 失敗時のメッセージは「人がそのまま行動に移せる」具体性・平易さを追求する。

## パフォーマンスとアクセシビリティ

- 事前レンダリング、遅延読み込み、画像最適化、フォントの最小化などを共有設定で行い、各アプリの実装負担を減らす。
- 「読みやすさ」「見つけやすさ」「一貫した操作感」を損なわない範囲で、表示速度を積極的に改善する。
- a11y チェック（見出し階層、コントラスト、キーボード操作可能性等）は共有レイヤーで標準化する。

## 命名と構造チェックリスト（運用用）

- [ ] ルート構成は `apps/<project>/src/content/docs/<version>/<lang>/` を守る。
- [ ] `<version>` は `v1` などの形式で `project.config.json` と一致する。
- [ ] `<lang>` は ISO コード（例: `en`, `ja`, `zh-Hans`）で `supportedLangs` と一致する。
- [ ] カテゴリは `NN-slug`（例: `01-guide`）でゼロ埋め連番、全言語で同一構造。
- [ ] ドキュメントは `NN-slug.mdx`（例: `02-setup-and-structure.mdx`）で連番・重複なし。
- [ ] スラッグは英小文字・ハイフン区切り。翻訳でも構造は不変。
- [ ] 構造や番号を変えたら `pnpm build:sidebar` 等で結果を検証する。

## 日常ワークフローの標準

- セットアップ：`pnpm install` → `pnpm dev` で全体を確認。
- コンテンツ追加：`scripts/` のユーティリティで作成 → 編集（MDX） → プレビュー。
- 検証：`pnpm build`（必要に応じて選択ビルド `pnpm build:selective --projects=...`）。
- デプロイ：既定のパイプラインに従い、共有設定の整合性を崩さない。

## 変更管理とドキュメント化

- 共有レイヤーの変更は影響範囲を明示し、小さな差分で段階的に進める。
- 新機能・新フローは `README.md` と `docs/` 配下のガイドを更新し、学習コストを下げる。
- 重要な判断は簡易 ADR（Decision Record）を残し、後から辿れるようにする。

---

本改訂案は、直感的なファイル管理と安全性の両立、モノレポの一元管理、読みやすさと表示速度の確保を同時に満たすための実践的な基準を示します。運用状況や利用者のフィードバックに応じ、定期的に見直し・更新してください。
